<div class="container">
    <h2>Organizer Dashboard</h2>

    <mat-card class="form-card">
        <mat-card-header>
            <mat-card-title>{{ isEditMode ? 'Edit Event' : 'Create New Event' }}</mat-card-title>
        </mat-card-header>
        <mat-card-content class="form-content">
            <mat-form-field appearance="outline">
                <mat-label>Event Name</mat-label>
                <input matInput [(ngModel)]="newEvent.name" required #name="ngModel">
                <mat-error *ngIf="name.invalid">Event Name is <strong>required</strong></mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
                <mat-label>Category</mat-label>
                <input matInput [(ngModel)]="newEvent.category" required #category="ngModel">
                <mat-error *ngIf="category.invalid">Category is <strong>required</strong></mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
                <mat-label>Venue</mat-label>
                <input matInput [(ngModel)]="newEvent.venue" required #venue="ngModel">
                <mat-error *ngIf="venue.invalid">Venue is <strong>required</strong></mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
                <mat-label>Capacity</mat-label>
                <input matInput type="number" [(ngModel)]="newEvent.capacity" required min="1" #capacity="ngModel">
                <mat-error *ngIf="capacity.invalid">Capacity must be greater than <strong>0</strong></mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
                <mat-label>Date & Time (YYYY-MM-DD HH:mm:ss)</mat-label>
                <input matInput [(ngModel)]="newEvent.date_time" required #date="ngModel">
                <mat-error *ngIf="date.invalid">Date is <strong>required</strong></mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
                <mat-label>Description</mat-label>
                <textarea matInput [(ngModel)]="newEvent.description"></textarea>
            </mat-form-field>
            <mat-form-field appearance="outline">
                <mat-label>Image URL</mat-label>
                <input matInput [(ngModel)]="newEvent.image_url">
            </mat-form-field>
        </mat-card-content>
        <mat-card-actions>
            <button mat-raised-button color="primary" (click)="saveEvent()">{{ isEditMode ? 'Update Event' : 'Create
                Event' }}</button>
            <button mat-button *ngIf="isEditMode" (click)="resetForm()">Cancel</button>
        </mat-card-actions>
    </mat-card>

    <div class="table-container">
        <h3>My Events</h3>
        <table mat-table [dataSource]="events" class="mat-elevation-z8">
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef> Name </th>
                <td mat-cell *matCellDef="let element"> {{element.name}} </td>
            </ng-container>

            <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef> Date </th>
                <td mat-cell *matCellDef="let element"> {{element.date_time | date:'short'}} </td>
            </ng-container>

            <ng-container matColumnDef="venue">
                <th mat-header-cell *matHeaderCellDef> Venue </th>
                <td mat-cell *matCellDef="let element"> {{element.venue}} </td>
            </ng-container>

            <ng-container matColumnDef="capacity">
                <th mat-header-cell *matHeaderCellDef> Capacity </th>
                <td mat-cell *matCellDef="let element"> {{element.capacity}} </td>
            </ng-container>

            <ng-container matColumnDef="sold">
                <th mat-header-cell *matHeaderCellDef> Sold </th>
                <td mat-cell *matCellDef="let element"> {{element.tickets_sold}} </td>
            </ng-container>

            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef> Actions </th>
                <td mat-cell *matCellDef="let element">
                    <button mat-icon-button color="accent" (click)="viewAttendees(element)" matTooltip="View Attendees">
                        <mat-icon>people</mat-icon>
                    </button>
                    <button mat-icon-button color="primary" (click)="editEvent(element)">
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button color="warn" (click)="deleteEvent(element.id)">
                        <mat-icon>delete</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
    </div>
</div>